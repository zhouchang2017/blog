<!doctype html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js"></script>
    <style>
        * {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 300;
        }
        #filter-form {
            position: relative;
            top: 25px;
            left: 10px;
            width: 300px;
        }
        #filter {
            height: 1.2em;
            width: 8em;
        }
        #filter:focus {
            width: 15em;
        }
        #selector-form {
            position: absolute;
            right: 20px;
            width: 100px;
            z-index: 1000;
            text-align: right;
        }
    </style>
</head>

<body>
    <h1>Logbench</h1>

    <p>Logbench is comparing benchmark results of popular Golang logging libraries.</p>

    <div id="filter-form">
        <label for="filter">Filter: </label><input id="filter" type="text">
    </div>
    <div id="selector-form">
        <select>
            <option value="ns/op">ns/op</option>
            <option value="B/op">B/op</option>
            <option value="allocs/op">allocs/op</option>
        </select>
    </div>
    <div id="chart"><canvas></canvas></div>

    <script>
        var reports = JSON.parse("{\"B/op\":{\"labels\":[\"CallerEnabled/WithFields/MsgComplex-6\",\"CallerEnabled/WithFields/Msg-6\",\"CallerEnabled/WithFields/Formatting-6\",\"CallerEnabled/NoWithFields/MsgComplex-6\",\"CallerEnabled/NoWithFields/Msg-6\",\"CallerEnabled/NoWithFields/Formatting-6\",\"CallerDisabled/WithFields/MsgComplex-6\",\"CallerDisabled/WithFields/Msg-6\",\"CallerDisabled/WithFields/Formatting-6\",\"CallerDisabled/NoWithFields/MsgComplex-6\",\"CallerDisabled/NoWithFields/Msg-6\",\"CallerDisabled/NoWithFields/Formatting-6\"],\"datasets\":[{\"label\":\"ZerologStudioFormatRaw\",\"data\":[4462,4318,8060,2362,2218,5970,3981.3,3837,7579,1889,1745,5489]},{\"label\":\"ZerologStudioFormatPlain\",\"data\":[4895,4751,8494,2682,2538,6282.5,4222,4077.3999999999996,7832,2018,1873,5617]},{\"label\":\"ZerologStudioFormatJson\",\"data\":[296,296,1633,296,296,1633,0,0,1337,0,0,1336.7]},{\"label\":\"LogrusStudioFormatRaw\",\"data\":[1184.7,1152,3805,1040,848,4046.6,688,656,3309,544,352,3550.6]},{\"label\":\"LogrusStudioFormatPlain\",\"data\":[1705,1673,4710.299999999999,1177,1113,3333.5,1161,1128,4166.3,632,568,2789]},{\"label\":\"LogrusStudioFormatJson\",\"data\":[3038,3006,4769.333333333333,2091,2059,3817.5,1578,1546,3306,1225,1193,2952]}]},\"allocs/op\":{\"labels\":[\"CallerEnabled/WithFields/MsgComplex-6\",\"CallerEnabled/WithFields/Msg-6\",\"CallerEnabled/WithFields/Formatting-6\",\"CallerEnabled/NoWithFields/MsgComplex-6\",\"CallerEnabled/NoWithFields/Msg-6\",\"CallerEnabled/NoWithFields/Formatting-6\",\"CallerDisabled/WithFields/MsgComplex-6\",\"CallerDisabled/WithFields/Msg-6\",\"CallerDisabled/WithFields/Formatting-6\",\"CallerDisabled/NoWithFields/MsgComplex-6\",\"CallerDisabled/NoWithFields/Msg-6\",\"CallerDisabled/NoWithFields/Formatting-6\"],\"datasets\":[{\"label\":\"ZerologStudioFormatRaw\",\"data\":[99,98,139,39,38,79,90,89,130,30,29,70]},{\"label\":\"ZerologStudioFormatPlain\",\"data\":[122,121,162,47,46,87,111,110,151,36,35,76]},{\"label\":\"ZerologStudioFormatJson\",\"data\":[3,3,43,3,3,43,0,0,40,0,0,40]},{\"label\":\"LogrusStudioFormatRaw\",\"data\":[16,16,56,11,10,50,13,13,53,8,7,47]},{\"label\":\"LogrusStudioFormatPlain\",\"data\":[26,26,66,16,16,55,21,21,61,11,11,50]},{\"label\":\"LogrusStudioFormatJson\",\"data\":[47,47,86,38,38,77,33,33,72,25,25,64]}]},\"ns/op\":{\"labels\":[\"CallerEnabled/WithFields/MsgComplex-6\",\"CallerEnabled/WithFields/Msg-6\",\"CallerEnabled/WithFields/Formatting-6\",\"CallerEnabled/NoWithFields/MsgComplex-6\",\"CallerEnabled/NoWithFields/Msg-6\",\"CallerEnabled/NoWithFields/Formatting-6\",\"CallerDisabled/WithFields/MsgComplex-6\",\"CallerDisabled/WithFields/Msg-6\",\"CallerDisabled/WithFields/Formatting-6\",\"CallerDisabled/NoWithFields/MsgComplex-6\",\"CallerDisabled/NoWithFields/Msg-6\",\"CallerDisabled/NoWithFields/Formatting-6\"],\"datasets\":[{\"label\":\"ZerologStudioFormatRaw\",\"data\":[3736.3333333333335,3739.8999999999996,6158.599999999999,1576.111111111111,1488.75,3845.1,3168.6,3051.8999999999996,5504,1205.8,1038.4444444444446,3114.4]},{\"label\":\"ZerologStudioFormatPlain\",\"data\":[3948.5,4424.7,6604.555555555556,2057.7,1716.8749999999998,4981.0999999999985,3902.8000000000006,3566.2,6242.4,1253.125,1345.7777777777778,3359.8888888888887]},{\"label\":\"ZerologStudioFormatJson\",\"data\":[317.6,338.1,1423.888888888889,327.55555555555554,299.1,1452.4,90.15555555555557,82.02222222222223,1221.9,84.35555555555555,73.14,1181]},{\"label\":\"LogrusStudioFormatRaw\",\"data\":[3740.5555555555557,3623,9629.6,2700.5,2609,8253.499999999998,1891,1924.6666666666667,6923.4,671.3,535.1,3189]},{\"label\":\"LogrusStudioFormatPlain\",\"data\":[5082.5,4927.555555555556,11047.777777777777,3456.6,3363.25,8685.444444444445,2948.9,2901.7,8470.499999999998,1104.1000000000001,1144.0999999999997,3703.1111111111113]},{\"label\":\"LogrusStudioFormatJson\",\"data\":[8977.7,8888.777777777777,15323.777777777777,6296.7,6277.111111111111,12544.333333333334,4857.199999999999,4820.125,10851,2862.2000000000003,2768.4444444444443,8792.199999999999]}]}}");
        var unit = "ns/op";
        var data = reports[unit];
        var barThickness = 10;
        var chartColors = {
            blue: 'rgb(54, 162, 235)',
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            green: 'rgb(75, 192, 192)',
            yellow: 'rgb(255, 205, 86)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };
        var colorNames = Object.keys(chartColors);
        $('#selector-form select').change(function() {
            unit = $('option:selected', this).text();
            data = reports[unit];
            var ds = filterDatasets(data, $('#filter').val());
            chart.data = ds;
            chart.update();
        });
        $('#filter').on('keyup', function () {
            var ds = filterDatasets(data, $(this).val());
            chart.data = ds;
            resizeWithDataset(ctx, ds);
            chart.update();
            chart.resize();
        });
        var ctx = $('#chart');
        resizeWithDataset(ctx, data);
        Object.keys(reports).forEach(function(unit) {
            var data = reports[unit];
            for (var i = 0; i < data.datasets.length; i++) {
                var colorName = colorNames[i % colorNames.length];
                var dsColor = chartColors[colorName];
                data.datasets[i].backgroundColor = Chart.helpers.color(dsColor).alpha(0.5).rgbString();
            }
        });
        var dataFilter = '';
        var chart = new Chart($('canvas', ctx), {
            type: 'horizontalBar',
            data: data,
            options: {
                
                
                elements: {
                    rectangle: {
                        borderWidth: 2,
                    }
                },
                devicePixelRatio: Math.min(window.devicePixelRatio, 2),
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    position: 'top',
                },
                tooltips: {
                    callbacks: {
                        label: function (tooltipItems, data) {
                            return data.datasets[tooltipItems.datasetIndex].label + ': ' + (isNaN(tooltipItems.xLabel) ? 'n/a' : tooltipItems.xLabel + ' ' + unit);
                        }
                    }
                },
            }
        });

        function resizeWithDataset(ctx, ds) {
            ctx.css("height", (ds.labels.length * ds.datasets.length * barThickness) + 20 + "px");
        }
        var options = {
            threshold: 0.2,
            location: 0,
            distance: 200,
            maxPatternLength: 100,
            minMatchCharLength: 1,
        };
        var fuse = new Fuse(data.labels, options);
        function filterDatasets(ds, labelFilter) {
            if (labelFilter == '') {
                return ds;
            }
            var newDs = {
                labels: [],
                datasets: [],
            };
            for (var i = 0; i < data.datasets.length; i++) {
                newDs.datasets[i] = {
                    label: data.datasets[i].label,
                    backgroundColor: data.datasets[i].backgroundColor,
                    data: [],
                };
            }
            fuse.search(labelFilter).forEach(function(i) {
                newDs.labels.push(data.labels[i]);
                for (var j = 0; j < data.datasets.length; j++) {
                    newDs.datasets[j].data.push(data.datasets[j].data[i]);
                }
            });
            return newDs;
        }
    </script>
</body>

</html>
